# Blocking


## Table Of Contents
1. [ë¸”ë¡œí‚¹](#ë¸”ë¡œí‚¹)
1. [ì½œë°± í•¨ìˆ˜](#ì½œë°±-í•¨ìˆ˜)
1. [Arrow Function](#arrow-function)
1. [Welcome To Callback Hell](#welcome-to-callback-hell)
1. [Promise](#promise)
1. [ë¹„ë™ê¸° ì œì–´ ë””ìžì¸ íŒ¨í„´ GET](#ë¹„ë™ê¸°-ì œì–´-ë””ìžì¸-íŒ¨í„´-get)
1. [ë¹„ë™ê¸° ì œì–´ ë””ìžì¸ íŒ¨í„´ POST](#ë¹„ë™ê¸°-ì œì–´-ë””ìžì¸-íŒ¨í„´-post)
1. [ë¹„ë™ê¸° ì œì–´ ë””ìžì¸ íŒ¨í„´ PUT](#ë¹„ë™ê¸°-ì œì–´-ë””ìžì¸-íŒ¨í„´-put)
1. [ë¹„ë™ê¸° ì œì–´ ë””ìžì¸ íŒ¨í„´ DELETE](#ë¹„ë™ê¸°-ì œì–´-ë””ìžì¸-íŒ¨í„´-delete)

---


## ë¸”ë¡œí‚¹
- Node.js í”„ë¡œì„¸ìŠ¤ì—ì„œ ì¶”ê°€ì ì¸ JavaScriptì˜ ì‹¤í–‰ì„ ìœ„í•´ JavaScriptê°€ ì•„ë‹Œ ìž‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì•¼ë§Œ í•˜ëŠ” ìƒí™©
- ì¼ë°˜ì ìœ¼ë¡œ NodeJSì˜ I/O ë…¼ë¸”ë¡œí‚¹ìœ¼ë¡œ ì•žì„  ìž‘ì—…ì´ ì™„ë£Œë ë•Œê¹Œì§€ í›„ìˆœìœ„ ìž‘ì—…ì´ ê¸°ë‹¤ë ¤ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.
- I/Oëž€ ì¸í’‹,ì•„ì›ƒí’‹ìœ¼ë¡œ ì¼ë°˜ì ìœ¼ë¡œ ì‹œìŠ¤í…œ ë””ìŠ¤í¬ ë° ë„¤íŠ¸ì›Œí¬ì™€ ìƒí˜¸ìž‘ìš©í•˜ëŠ” ê²ƒìœ¼ë¡œ ì´í•´í•˜ë©´ ë©ë‹ˆë‹¤.

```js
// ë¸”ë¡œí‚¹ ì½”ë“œ
const fs = require('fs');
const data = fs.readFileSync('/file.md'); // íŒŒì¼ì„ ì½ì„ ë•Œê¹Œì§€ ì—¬ê¸°ì„œ ë¸”ë¡œí‚¹ ë©ë‹ˆë‹¤.
//ìœ„ ì½”ë“œëŠ” ì—ëŸ¬ í•¸ë“¤ë§ì´ ì—†ìŒ

//non ë¸”ë¡œí‚¹ ì½”ë“œ
//ë…¼ë¸”ë¡œí‚¹ ì½”ë“œëŠ” ê¸°ë‹¤ë ¤ ì£¼ì§€ ì•ŠìŒìœ¼ë¡œ, ìž‘ì—…ì´ ì™„ë£Œëœ í›„ ì½”ë“œ ì‹¤í–‰ì„ ì›í•œë‹¤ë©´ ì•„ëž˜ì™€ ê°™ì´ ì½œë°± í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.
fs.readFile('/file.md', (err, data) => {
    if (err) throw err;
    console.log(data);
});
```

> ë…¼ë¸”ë¡œí‚¹ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” ì›¹ì•±ì˜ í¼í¬ë¨¼ìŠ¤ë¥¼ ê·¹ëŒ€í™” í•˜ê¸° ìœ„í•¨ìž…ë‹ˆë‹¤.  
> ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œë§ˆë‹¤ ì§€ì—°ì´ ë°œìƒí•˜ê³ , ë‹¤ë¥¸ ìž‘ì—…ì´ ì™„ë£Œë˜ì§€ ëª»í•œë‹¤ë©´ ì•±ì˜ ì„±ëŠ¥ì´ í™•ì—°ížˆ ë–¨ì–´ì§ˆ ê²ƒìž…ë‹ˆë‹¤.

![blocking_structure](https://user-images.githubusercontent.com/60806840/83943516-d5b07380-a837-11ea-80ab-6df0bac73a5d.png)

**[â¬† back to top](#table-of-contents)**

## ì½œë°± í•¨ìˆ˜
- ì²«ë²ˆì§¸ í•¨ìˆ˜ê°€ ì‹¤í–‰ëœ ê²°ê³¼ì— ë”°ë¼ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
- ìœ„ì˜ readFile í•¨ìˆ˜ì˜ íŒŒì¼ì„ ì½ì€ ê²°ê³¼ë¥¼ ì•Œê³  ì‹¶ì„ ê²½ìš°, ì• ë¡œìš° íŽ‘ì…˜ì„ ì´ìš©í•´ ì½œë°±í•¨ìˆ˜ë¥¼ êµ¬í˜„í•˜ì—¬ í™•ì¸í•  ìˆ˜ ìžˆì—ˆë‹¤.

```js
function callFunction(callback){
  console.log("callFunction called")
  let one = 1
  let two = 2
  let result = one+two
  if(result>2){
      callback("biggner than 2")
  } else {
      callback("not biggner than 2")
  }
}

callFunction(function(message){
    console.log(message)
})
```

## Arrow Function
- í™”ì‚´í‘œ í•¨ìˆ˜ëŠ” ìµëª…í•¨ë¡œ functionì´ë¼ëŠ” í‘œí˜„ì„ ëŒ€ì‹ í•˜ëŠ” í•¨ìˆ˜ ìž…ë‹ˆë‹¤.
- ë‹¤ë§Œ this, super ë“±ì´ ì—†ê³  ìƒì„±ìžë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
- ì´ ë•Œë¬¸ì— ë©”ì†Œë“œë¡œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ê³ , ì£¼ë¡œ ì½œë°±í•¨ìˆ˜ë¡œ ë§Žì´ ì‚¬ìš©í•©ë‹ˆë‹¤.

```js
var wakeUp =  function(){
  console.log('wake up!')
}
setInterval(wakeUp, 1000);
//íŠ¹ì • ê¸°ê°„ë™ì•ˆ íŠ¹ì • ê¸°ëŠ¥ì„ ì‹¤í–‰ í•˜ëŠ” í•¨ìˆ˜
//wakeUpì€ setIntervalì´ë¼ëŠ” í•¨ìˆ˜ì˜ ê²°ê³¼ë¡œ ì‹¤í–‰ë˜ëŠ” 'callback' í•¨ìˆ˜ ìž…ë‹ˆë‹¤.

//ìœ„ í•¨ìˆ˜ëŠ” ì•„ëž˜ì™€ ê°™ì´ ìµëª…í•¨ìˆ˜ë¡œ ë³€ê²½í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
setInterval(function(){
  console.log('wake up!')
}, 1000);

//ê·¸ë¦¬ê³  ì´ëŸ¬í•œ ìµëª…í•¨ìˆ˜ëŠ” ì•„ëž˜ì™€ ê°™ì´ í™”ì‚´í‘œ í•¨ìˆ˜ í‘œí˜„ìœ¼ë¡œ ëŒ€ì²´í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
setInterval(() => {
  console.log('wake up!')
}, 1000);
```
**[â¬† back to top](#table-of-contents)**


## Welcome To Callback Hell
- ì˜ˆì „ Javascript ê°œë°œìžëŠ” ì½œë°± ì§€ì˜¥ì´ë¼ëŠ” í‘œí˜„ì„ ë§Žì´ ì¼ìŠµë‹ˆë‹¤.
- ìš°ë¦¬ê°€ ë‹¤ìŒê³¼ ê°™ì€ í•¨ìˆ˜ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ìž‘ì„±í•œë‹¤ê³  í•´ë´…ì‹œë‹¤.

```js
setTimeout(() => {
    console.log('sleep')
}, 3000);
setTimeout(() => {
    console.log('wake up!')
}, 1000);
console.log('eat');
```

> ì €ëŠ” 3ì´ˆë¥¼ ìžê³ , 1ì´ˆ í›„ì— ì¼ì–´ë‚˜ì„œ, ë¨¹ê¸°ë¥¼ ë°”ë¼ì§€ë§Œ ì‹¤ì œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œëŠ” ê·¸ë ‡ì§€ ì•Šì„ ê²ƒìž…ë‹ˆë‹¤.  
> ë•Œë¬¸ì— ìš°ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œë¥¼ ì§œê²Œ ë©ë‹ˆë‹¤.

```js
setTimeout(() => {
  console.log('sleep')
    setTimeout(() => {
      console.log('wake up!')
      console.log('eat');
  }, 1000);    
}, 3000);
```
> ë²Œì¨ ì¢€ ë³µìž¡í•´ ë³´ì´ëŠ”ê²Œ ëŠê»´ì§€ì‹œë‚˜ìš”?  
> ë§Œì•½ ì´ ì½œë°±ì´ ì—¬ëŸ¬ë²ˆ ê°€ê²Œ ëœë‹¤ë©´? ê·¸ê²ƒì´ ë°”ë¡œ ì½œë°± ì§€ì˜¥ ìž…ë‹ˆë‹¤.

## Promise
- ì´ëŸ° ë…¼ë¸”ë¡œí‚¹ ì½”ë“œë¥¼ ì œì–´í•˜ê¸° ìœ„í•´ ìš°ë¦¬ëŠ” Promiseë¥¼ ì”ë‹ˆë‹¤.
- Promiseë¥¼ ì–´ë–»ê²Œ ì“°ëŠ” ì§€ ì•Œì•„ë³´ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ê°„ë‹¨í•œ ì½”ë“œë¥¼ í•œë²ˆ ìž‘ì„±í•´ ë´…ë‹ˆë‹¤.
- ìš°ë¦¬ëŠ” Routerê°€ ë„ˆë¬´ ë³µìž¡í•´ì ¸ì„œ, query ëª¨ë¸ì„ ë¶„ë¦¬í•˜ê¸°ë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤.

```js
module.exports.getList = (connection, options) => {
  connection.query('SELECT * FROM schools ', options.schoolName,  function (error, results, fields) {
    if (error) {
      res.status(404).json({result:false})
        throw error;
    }                   
    connection.commit(async function(err) {
      if (err) {
        res.status(404).json({result:false})
        throw err;                    
      }                
      console.log('results : ',results)
      return results;
    });                
  });    
});
```
> ê·¸ë¦¬ê³  ê¸°ì¡´ ì½”ë“œì—ì„œëŠ” ì•„ëž˜ì™€ ê°™ì´ getList ëª¨ë“ˆì„ ê°€ì ¸ì˜¤ê¸°ë¡œ í•©ë‹ˆë‹¤.

```js
var school = require('../models/school')
pool.getConnection(function(err, connection) {
  const results =  school.getList(connection, {schoolName:schoolName})
  console.log('success')
  res.status(200).json({result:results})        
})
```
> ì„ ìƒë‹˜ðŸ‘¨â€ðŸ«: ìœ„ ì½”ë“œë¥¼ ì‹¤í–‰í•´ë³´ë©´, ì¿¼ë¦¬ ë¬¸ì˜ resultsëŠ” ì½˜ì†”ë¡œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìžˆì§€ë§Œ ì–´ì©ì¼ì¸ì§€, í´ë¼ì´ì–¸íŠ¸ì— ì‘ë‹µí•˜ëŠ” resultëŠ” ë¹ˆ ê°’ìœ¼ë¡œ ë‚˜ê°€ê²Œ ë©ë‹ˆë‹¤.  
> NodeJSì˜ ë…¼ë¸”ë¡œí‚¹ì— ë”°ë¼, ë””ë¹„ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸° ì „ì— ì´ë¯¸ ì‘ë‹µí•˜ê¸° ë•Œë¬¸ìž…ë‹ˆë‹¤.  
> ìš°ë¦¬ëŠ” ìœ„ ì½”ë“œë¥¼ ì•„ëž˜ì™€ ê°™ì´ ë°”ê¿€ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

```js
module.exports.getList = (connection, options) => {
  return new Promise((resolve, reject) => {
    connection.query('SELECT * FROM schools ', options.schoolName,  function (error, results, fields) {
      // connection.query(query,  function (error, results, fields) {
          if (error) {
            res.status(404).json({result:false})
              throw error;
          }                   
          connection.commit(async function(err) {
            if (err) {
              res.status(404).json({result:false})
              throw err;                    
            }                
            console.log('results : ',results)
            resolve(results);
          });                
      });
  });    
};
```

```js
var school = require('../models/school')
pool.getConnection(async function(err, connection) {
  const results = await school.getList(connection, {schoolName:schoolName})
  console.log('success')
  res.status(200).json({result:results})        
})
```

> ì„ ìƒë‹˜ðŸ‘¨â€ðŸ«: ê·¸ë¦¬ê³  ë‹¤ì‹œ ì‹¤í–‰í•´ ë³´ë©´ ì´ë²ˆì—ëŠ” ë¬´ì‚¬ížˆ ê°’ë“¤ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ê±¸ ì•Œ ìˆ˜ ìžˆìŠµë‹ˆë‹¤!
- resolve : ê²°ì • (return)
- reject : ê±°ë¶€ (ì—ëŸ¬)
- async : í•¨ìˆ˜ë¥¼ ë¸”ë¡œí‚¹ìœ¼ë¡œ ì œì–´í•˜ê¸° ìœ„í•´ ë¶™ì—¬ì£¼ëŠ” ëª…ë ¹ì–´
- await : ê¸°ë‹¤ë ¤ì•¼ í•˜ëŠ” í•¨ìˆ˜ ì•žì— ì¶”ê°€

> ì„ ìƒë‹˜ðŸ‘¨â€ðŸ«:  ì—¬ê¸°ì„œ í•˜ë‚˜ ì•Œì•„ì•¼í•  ê²ƒì´ ìžˆìŠµë‹ˆë‹¤.  
> ìš°ë¦¬ëŠ” êµ¬ì¡°í™”í•˜ê¸° ìœ„í•´ì„œ Promiseë¥¼ ì‚¬ìš©í•œ ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤.  
> ìš°ë¦¬ëŠ” êµ¬ì¡°í™”í•˜ëŠ” ê³¼ì •ì—ì„œ ë¹„ë™ê¸° íë¦„ì„ ì œì–´í•  í•„ìš”ë¥¼ ëŠê¼ˆê³ , ê·¸ë ‡ê¸° ë•Œë¬¸ì— Promiseë¥¼ ì‚¬ìš©í•œ ê²ƒìž…ë‹ˆë‹¤.  
> ì¼ì¢…ì˜ ë””ìžì¸ íŒ¨í„´ì„ ë§Œë“¤ê¸° ìœ„í•´ì„œ ê¼­ Promiseë¥¼ ì¨ì•¼ í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë¼ëŠ” ì ì„ ë§ì”€ë“œë¦¬ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤.  

**[â¬† back to top](#table-of-contents)**

## ë¹„ë™ê¸° ì œì–´ ë””ìžì¸ íŒ¨í„´ GET
- ê·¸ë¦¬ê³  ì´ë ‡ê²Œ Promiseë¥¼ í™œìš©í•˜ë©´ ì½”ë“œë¥¼ ë”ìš± ë©‹ì§€ê²Œ êµ¬ì¡°í™”í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
- ë¨¼ì € componentsì— db.js íŒŒì¼ì„ ë§Œë“¤ê³ , ì•„ëž˜ì™€ ê°™ì´ ì½”ë“œë¥¼ ë„£ì–´ ì¤ë‹ˆë‹¤.

```js
const config = require('../config')
const mysql = require('mysql')

var pool  = mysql.createPool({
  connectionLimit : config.database.connectionLimit,
  host: config.database.host,
  user: config.database.user,
  password: config.database.password,
  database: config.database.database
});

module.exports.query = (options) => {
  return new Promise((resolve, reject) => {
    pool.getConnection(function(err, connection) {
      if (err) reject(err); // not connected!
      connection.query(options.query, options.value,  function (error, results, fields) {
        if (error) {                    
          reject(error)
        }                   
        connection.commit(async function(err) {
          if (err) {
            reject(err)                 
          }                
          console.log('results : ',results)
          resolve(results);
        });                
      });
    });
  });    
}
```

> ì„ ìƒë‹˜ðŸ‘¨â€ðŸ«: ìœ„ query ë¬¸ ì•ˆì—ëŠ” getConnectionê³¼ query ëª…ë ¹ì–´ë¥¼ ëŒë¦¬ëŠ” ì½”ë“œê°€ ëª¨ë‘ ë“¤ì–´ê°€ ìžˆìŠµë‹ˆë‹¤.  
> ì¦‰ ì´ì œ ë°˜ë³µì ìœ¼ë¡œ í•´ë‹¹ ë¬¸ì„ ë‹¤ì‹œ ì“°ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.  
> ê·¸ë¦¬ê³  modelsë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ì–´ school.jsë¥¼ ìƒì„±í•˜ê² ìŠµë‹ˆë‹¤.  
> ì´ì œ ì‹¤ì œ queryì— í•´ë‹¹í•˜ëŠ” ëª…ì˜ì–´ëŠ” ì´ model ë””ë ‰í† ë¦¬ì—ì„œ ìž‘ì„±í•  ì˜ˆì •ìž…ë‹ˆë‹¤.  

```js
const db = require('../components/db')

module.exports.getList = async (options) => {
  console.log('options : ',options)
  return await db.query({
    query: 'SELECT * FROM schools WHERE name = ?',
    value: options.schoolName
  })        
};
```

> ì„ ìƒë‹˜ðŸ‘¨â€ðŸ«: ìœ„ì™€ ê°™ì´ ìž‘ì„±í•˜ë©´ ì´ì œ ê°„ë‹¨í•˜ê²Œ queryë¥¼ ê´€ë¦¬í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤!  
> ë§ˆì§€ë§‰ìœ¼ë¡œ routesì˜ school.js ì˜ get ë©”ì†Œë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ê°„ë‹¨í•˜ê²Œ ë°”ê¿”ì¤„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

```js
router.get('/', async function (req, res) {
  const schoolName = req.query.schoolName
  const results = await school.getList({schoolName:schoolName})
  console.log('success')
  res.status(200).json({result:results})            
})
```

## ë¹„ë™ê¸° ì œì–´ ë””ìžì¸ íŒ¨í„´ POST
- ê·¸ë¦¬ê³  postë„ ìƒë‹¹ížˆ ë‹¤ë¥´ê²Œ ë³€ê²½í•  ìˆ˜ê°€ ìžˆìŠµë‹ˆë‹¤.
- POST, UPDATE, DELETEì˜ ê²½ìš° ìš°ë¦¬ëŠ” rollbackì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—, beginTransactionìœ¼ë¡œ ì½”ë“œë¥¼ ì‹œìž‘í•´ì•¼ í•©ë‹ˆë‹¤.
- ê·¸ëž˜ì„œ db.jsì— ì•„ëž˜ ì½”ë“œë¥¼ ì¶”ê°€í•˜ê² ìŠµë‹ˆë‹¤.

```js
module.exports.beginTransaction = () => {
  return new Promise((resolve, reject) => {
    pool.getConnection(function(err, connection) {
      if (err) reject(err); // not connected!
        // Use the connection
      connection.beginTransaction(function(err) {
        if (err) { reject(err); }
        resolve(connection)
      });
    });
  })
}
```
> ì„ ìƒë‹˜ðŸ‘¨â€ðŸ«: ë˜í•œ commitê³¼ rollbackë„ êµ¬í˜„ í•´ ì¤ë‹ˆë‹¤.

```js
module.exports.commit = connection => {
	return new Promise((resolve, reject) => {
		connection.commit(err => {
			if (err) reject(this.rollback(connection));
			else {
				connection.release();
				resolve();
			}
		});
	});
};

module.exports.rollback = connection => {
	return new Promise((resolve, reject) => {
		connection.rollback(err => {
			if (err) reject(err);
			else {
				connection.release();
				resolve();
			}
		});
	});
};
```
> routes/school.jsì˜ post ë©”ì†Œë“œë¥¼ ìˆ˜ì •í•´ ë³´ê² ìŠµë‹ˆë‹¤.

```js
router.post('/', async function (req, res) {
	try {
		const json = req.body;
		const connection = await db.beginTransaction();
		var newSchool = { name: json.name, address: json.address, type: json.type };
		const results = await school.insert(connection, newSchool);
		await db.commit(connection);
		if (results) {
			res.status(200).json({ result: results.insertId });
		}
	} catch (err) {
		console.log('err : ', err);
		await db.rollback(connection);
		next(err);
	}
});
```

- try...catchì—ì„œ catchëŠ” throw errê°€ ì¼ì–´ë‚¬ì„ ì‹œ(ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ì‹œì—), ì‹¤í–‰í•˜ëŠ” ì½”ë“œ ìž…ë‹ˆë‹¤.
- ì´ë•Œ ìš°ë¦¬ëŠ” rollbackì„ ì‹¤í–‰í•´ ì£¼ë©° next í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
- nextëŠ” ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” í•¨ìˆ˜ë¡œ, ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ì‹œ ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‹¤í–‰í•˜ë„ë¡ í•˜ì—¬ ë„˜ì–´ê°‘ë‹ˆë‹¤.
- ê·¸ë¦¬ê³  insert ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì•„ë¦„ë‹µê²Œ ë³€í•©ë‹ˆë‹¤.

```js
module.exports.insert = async (connection, options) => {
	console.log('options : ', options);
	return await db.query({
		connection: connection,
		query: 'INSERT INTO schools SET ?',
		value: options,
	});
};
```


## ë¹„ë™ê¸° ì œì–´ ë””ìžì¸ íŒ¨í„´ PUT
> putì€ ì´ì œ ì•„ì£¼ ì†ì‰½ê²Œ ê³ ì¹  ìˆ˜ê°€ ìžˆìŠµë‹ˆë‹¤.

```js
// routes/school.js
router.put('/', async function (req, res) {
	try {
		const json = req.body;
		const connection = await db.beginTransaction();
		var newSchool = { name: json.name, address: json.address, type: json.type };
		const results = await school.update(connection, {
			options: newSchool,
			idx: json.idx,
		});
		await db.commit(connection);
		if (results) {
			res.status(200).json({ result: results });
		}
	} catch (err) {
		console.log('err : ', err);
		await db.rollback(connection);
		next(err);
	}
});

//models/shool.js
module.exports.update = async (connection, options) => {
	console.log('options : ', options);
	return await db.query({
		connection: connection,
		query: 'UPDATE schools SET ? WHERE idx = ?',
		value: [options.options, options.idx],
	});
};
```

## ë¹„ë™ê¸° ì œì–´ ë””ìžì¸ íŒ¨í„´ DELETE
> delete ì—­ì‹œ ë§ˆì°¬ê°€ì§€ ìž…ë‹ˆë‹¤.

```js
// routes/school.js
router.delete('/', async function (req, res) {
	const json = req.body;
	try {
		const json = req.body;
		const connection = await db.beginTransaction();
		const results = await school.delete(connection, json.idx);
		await db.commit(connection);
		if (results) {
			res.status(200).json({ result: results });
		}
	} catch (err) {
		console.log('err : ', err);
		await db.rollback(connection);
		next(err);
	}
});

//models/shool.js
module.exports.delete = async (connection, options) => {
	console.log('options : ', options);
	return await db.query({
		connection: connection,
		query: 'DELETE FROM schools WHERE idx = ?',
		value: [options],
	});
};
```

**[â¬† back to top](#table-of-contents)**